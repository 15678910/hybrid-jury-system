name: CI

on:
  push:
    branches: [ main, dev ]
  pull_request:
    branches: [ main, dev ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    env:
      # ë ˆí¬ì§€í† ë¦¬ Settings > Secrets and variables > Actions ì—ì„œ
      # TELEGRAM_BOT_TOKEN / TELEGRAM_CHAT_ID ë¥¼ ë§Œë“¤ì–´ ë‘ì„¸ìš”.
      TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
      TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: 22
          cache: npm

      - name: Install dependencies
        run: npm ci

      # í•„ìš”í•˜ë©´ test ë‹¨ê³„ë„ ì¶”ê°€
      # - name: Run tests
      #   run: npm test -- --watch=false

      - name: Build project
        run: npm run build

      # ====== ì—¬ê¸°ì„œë¶€í„° í…”ë ˆê·¸ë¨ ì‹¤íŒ¨ ì•Œë¦¼ ======
      - name: Notify Telegram on failure
        if: failure() && env.TELEGRAM_CHAT_ID != '' && env.TELEGRAM_CHAT_ID != ''
        run: |
          TEXT="ğŸš¨ GitHub Actions ë¹Œë“œ/í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨ ì•Œë¦¼

ë ˆí¬ì§€í† ë¦¬ : ${{ github.repository }}
ë¸Œëœì¹˜     : ${{ github.ref_name }}
ì›Œí¬í”Œë¡œ   : ${{ github.workflow }}
ì¡ ID      : ${{ github.job }}
ì»¤ë°‹ SHA   : ${{ github.sha }}
ì‘ì„±ì     : ${{ github.actor }}

ë¡œê·¸ ë³´ê¸°:
https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}"

          curl -sS -X POST "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
            -d chat_id="${TELEGRAM_CHAT_ID}" \
            --data-urlencode "text=${TEXT}"
