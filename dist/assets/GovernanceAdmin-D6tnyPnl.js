import{C as Ie,r as i,b as p,d as x,m as ne,c as C,q as de,o as ie,g as T,j as e,L as ce,G as D,u as Pe,a as oe,e as Le}from"./index-BRv2x-XL.js";const xe=()=>"SbAdmin2025!",V=[{id:"jurySystem",title:"시민법관 참심제 도입",subtitle:"시민법관 참심제 도입에 대한 찬반 투표",description:"시민이 직업 법관과 함께 재판에 참여하여 유무죄와 양형을 결정하는 참심제 도입에 대해 시민 여러분의 의견을 묻습니다.",detail:"시민법관 참심제란?",detailContent:"일반 시민이 법관과 동등한 권한으로 재판에 참여하여 유무죄 판단과 양형을 함께 결정하는 제도입니다.",agreeText:"시민법관 참심제 도입에 찬성합니다",disagreeText:"시민법관 참심제 도입에 반대합니다",status:"active",color:"blue",deadline:"2026-03-31"},{id:"lawDistortion",title:"법왜곡죄 도입",subtitle:"법왜곡죄 국회 본회의 통과에 대한 찬반 투표",description:"더불어민주당에서 추진하는 법왜곡죄(형법 제131조의2) 신설안의 국회 본회의 통과에 대해 시민 여러분의 의견을 묻습니다.",detail:"법왜곡죄란?",detailContent:"법관, 검사 등 사법기관 종사자가 고의로 법을 왜곡하여 재판이나 수사를 진행한 경우 처벌하는 조항입니다.",agreeText:"법왜곡죄 도입에 찬성합니다",disagreeText:"법왜곡죄 도입에 반대합니다",status:"active",color:"red",deadline:"2026-03-31"},{id:"trialCourt",title:"내란전담재판부 설치",subtitle:"내란 사건 전담 재판부 설치에 대한 찬반 투표",description:"내란죄 등 국가 중대 범죄를 전문적으로 심리하는 전담 재판부 설치에 대해 시민 여러분의 의견을 묻습니다.",detail:"내란전담재판부란?",detailContent:"내란죄, 외환죄 등 국가의 존립과 헌정질서를 위협하는 중대 범죄를 전문적으로 심리하기 위한 특별 재판부입니다.",agreeText:"내란전담재판부 설치에 찬성합니다",disagreeText:"내란전담재판부 설치에 반대합니다",status:"active",color:"orange",deadline:"2026-03-31"}],ue=[{value:"blue",label:"파랑",bg:"#3b82f6"},{value:"red",label:"빨강",bg:"#ef4444"},{value:"orange",label:"주황",bg:"#f97316"},{value:"green",label:"초록",bg:"#22c55e"},{value:"purple",label:"보라",bg:"#a855f7"},{value:"pink",label:"분홍",bg:"#ec4899"}];function Ve(){const[G]=Ie(),[K,U]=i.useState(!1),[me,W]=i.useState(!1),[Z,ge]=i.useState(""),[I,u]=i.useState("");i.useEffect(()=>{const t=G.get("admin"),s=xe();t&&t===s?(U(!0),te()):W(!0)},[G]);const[S,c]=i.useState(!1),[H,o]=i.useState(""),[P,he]=i.useState("topics"),[b,j]=i.useState([]),[v,L]=i.useState(null),[F,q]=i.useState(!1),[N,E]=i.useState([]),[g,A]=i.useState(null),[be,pe]=i.useState({}),[f,je]=i.useState("all"),[w,J]=i.useState({}),[Q,fe]=i.useState({}),[ye,M]=i.useState(null),[m,k]=i.useState({agree:0,disagree:0,reason:""}),[X,ve]=i.useState([]),[$,Y]=i.useState({id:"",title:"",subtitle:"",description:"",detail:"",detailContent:"",agreeText:"",disagreeText:"",status:"active",color:"blue",deadline:""}),ee=()=>{const t=xe();Z===t?(U(!0),u(""),te()):u("관리자 코드가 올바르지 않습니다.")},te=async()=>{c(!0),await Promise.all([Ne(),we()]),c(!1)},Ne=async()=>{try{const t=p(x,"settings","governance"),s=await ne(t);if(s.exists()){const l=s.data();if(l.topics&&l.topics.length>0)j(l.topics),await R(l.topics);else{const n=V.map(r=>{var a;return{...r,deadline:((a=l.deadlines)==null?void 0:a[r.id])||r.deadline}});j(n),await R(n)}}else j(V),await R(V)}catch(t){console.error("설정 로드 오류:",t),j(V)}},we=async()=>{try{const t=C(x,"proposals"),s=de(t,ie("createdAt","desc")),n=(await T(s)).docs.map(a=>{var d,h;return{id:a.id,...a.data(),createdAt:((h=(d=a.data().createdAt)==null?void 0:d.toDate)==null?void 0:h.call(d))||new Date}});E(n);const r={};for(const a of n){const d=C(x,`proposal_supports_${a.id}`),h=await T(d);r[a.id]=h.size}pe(r)}catch(t){console.error("제안 로드 오류:",t)}},R=async t=>{const s={},l={};for(const n of t){try{const r=C(x,`votes_${n.id}`),a=await T(r);let d=0,h=0;a.docs.forEach(y=>{const _=y.data().vote;_==="agree"?d++:_==="disagree"&&h++}),s[n.id]={agree:d,disagree:h,total:d+h}}catch{s[n.id]={agree:0,disagree:0,total:0}}try{const r=C(x,`comments_${n.id}`),a=await T(r);l[n.id]=a.size}catch{l[n.id]=0}}J(s),fe(l)},Ce=async()=>{if(v){c(!0),u("");try{const t=b.map(l=>l.id===v.id?v:l),s=p(x,"settings","governance");await D(s,{topics:t,updatedAt:new Date},{merge:!0}),j(t),L(null),o("의제가 수정되었습니다."),setTimeout(()=>o(""),3e3)}catch(t){console.error("의제 수정 오류:",t),u("의제 수정에 실패했습니다.")}c(!1)}},De=async()=>{if(!$.title||!$.id){u("의제 ID와 제목은 필수입니다.");return}if(b.some(t=>t.id===$.id)){u("이미 존재하는 의제 ID입니다.");return}c(!0),u("");try{const t=[...b,{...$,status:"active"}],s=p(x,"settings","governance");await D(s,{topics:t,updatedAt:new Date},{merge:!0}),j(t),Y({id:"",title:"",subtitle:"",description:"",detail:"",detailContent:"",agreeText:"",disagreeText:"",status:"active",color:"blue",deadline:""}),q(!1),o("새 의제가 추가되었습니다."),setTimeout(()=>o(""),3e3)}catch(t){console.error("의제 추가 오류:",t),u("의제 추가에 실패했습니다.")}c(!1)},Se=async t=>{if(window.confirm("정말로 이 의제를 삭제하시겠습니까?")){c(!0);try{const s=b.filter(n=>n.id!==t),l=p(x,"settings","governance");await D(l,{topics:s,updatedAt:new Date},{merge:!0}),j(s),o("의제가 삭제되었습니다."),setTimeout(()=>o(""),3e3)}catch{u("의제 삭제에 실패했습니다.")}c(!1)}},se=t=>/[ㄱ-ㅎ|ㅏ-ㅣ|가-힣]/.test(t),ae=()=>"topic_"+Date.now()+"_"+Math.random().toString(36).substring(2,8),Ae=async t=>{if(!se(t.id)){alert("이 의제는 이미 영문 ID를 사용하고 있습니다.");return}const s=ae();if(window.confirm(`의제 "${t.title}"의 ID를 영문으로 변경하시겠습니까?

기존 ID: ${t.id}
새 ID: ${s}

⚠️ 주의: 기존 투표 및 댓글 데이터는 유지되지 않습니다.`)){c(!0),u("");try{const l=b.map(r=>r.id===t.id?{...r,id:s,originalId:t.id}:r),n=p(x,"settings","governance");await D(n,{topics:l,updatedAt:new Date},{merge:!0}),j(l),await R(l),o(`의제 ID가 "${s}"로 변경되었습니다. 이제 투표가 정상 작동합니다.`),setTimeout(()=>o(""),5e3)}catch(l){console.error("ID 마이그레이션 오류:",l),u("ID 변경에 실패했습니다.")}c(!1)}},Te=async t=>{const s=ae(),l=new Date;l.setDate(l.getDate()+30);const n={id:s,title:t.title,subtitle:t.subtitle||`${t.title}에 대한 찬반 투표`,description:t.description,detail:`${t.title}란?`,detailContent:t.description,agreeText:`${t.title}에 찬성합니다`,disagreeText:`${t.title}에 반대합니다`,status:"active",color:"green",deadline:l.toISOString().split("T")[0],promotedFrom:"proposal"};c(!0);try{const r=[...b,n],a=p(x,"settings","governance");await D(a,{topics:r,updatedAt:new Date},{merge:!0}),j(r);const d=p(x,"proposals",t.id);await Pe(d,{status:"promoted",promotedAt:new Date}),E(h=>h.map(y=>y.id===t.id?{...y,status:"promoted"}:y)),o("제안이 정식 의제로 승격되었습니다."),setTimeout(()=>o(""),3e3)}catch{u("승격에 실패했습니다.")}c(!1)},ke=async t=>{if(window.confirm("정말로 이 제안을 삭제하시겠습니까?")){c(!0);try{await oe(p(x,"proposals",t)),E(s=>s.filter(l=>l.id!==t)),o("제안이 삭제되었습니다."),setTimeout(()=>o(""),3e3)}catch{u("제안 삭제에 실패했습니다.")}c(!1)}},$e=async()=>{if(g){c(!0);try{const t=p(x,"proposals",g.id);await D(t,{title:g.title,description:g.description,status:g.status,updatedAt:new Date},{merge:!0}),E(s=>s.map(l=>l.id===g.id?g:l)),A(null),o("제안이 수정되었습니다."),setTimeout(()=>o(""),3e3)}catch{u("제안 수정에 실패했습니다.")}c(!1)}},le=t=>{const s=ue.find(l=>l.value===t);return s?s.bg:"#3b82f6"},Re=async t=>{if(window.confirm("테스트 투표 데이터(admin_test_*)를 삭제하시겠습니까?")){c(!0);try{const s=C(x,`votes_${t}`),l=await T(s);let n=0;for(const r of l.docs)r.id.startsWith("admin_test_")&&(await oe(p(x,`votes_${t}`,r.id)),n++);await R(b),o(`${n}개의 테스트 투표가 삭제되었습니다.`),setTimeout(()=>o(""),3e3)}catch{u("테스트 투표 삭제에 실패했습니다.")}c(!1)}},_e=async t=>{var r,a,d;if(!m.reason.trim()){u("조정 사유를 입력해주세요.");return}const s=w[t]||{agree:0,disagree:0},l=Math.max(0,s.agree+m.agree),n=Math.max(0,s.disagree+m.disagree);c(!0);try{const h=C(x,"vote_adjustments");await Le(h,{topicId:t,topicTitle:((r=b.find(B=>B.id===t))==null?void 0:r.title)||t,beforeAgree:s.agree,beforeDisagree:s.disagree,adjustAgree:m.agree,adjustDisagree:m.disagree,afterAgree:l,afterDisagree:n,reason:m.reason,adjustedAt:new Date,adjustedBy:"admin"});const y=p(x,"settings","vote_adjustments"),_=await ne(y),z=_.exists()?_.data().adjustments||{}:{};await D(y,{adjustments:{...z,[t]:{agree:(((a=z[t])==null?void 0:a.agree)||0)+m.agree,disagree:(((d=z[t])==null?void 0:d.disagree)||0)+m.disagree}},updatedAt:new Date},{merge:!0}),J(B=>({...B,[t]:{agree:l,disagree:n,total:l+n}})),k({agree:0,disagree:0,reason:""}),M(null),o("투표 수가 조정되었습니다. 조정 이력이 기록되었습니다."),setTimeout(()=>o(""),3e3),await O()}catch(h){console.error("투표 조정 오류:",h),u("투표 수 조정에 실패했습니다.")}c(!1)},O=async()=>{try{const t=C(x,"vote_adjustments"),s=de(t,ie("adjustedAt","desc")),n=(await T(s)).docs.map(r=>{var a,d;return{id:r.id,...r.data(),adjustedAt:((d=(a=r.data().adjustedAt)==null?void 0:a.toDate)==null?void 0:d.call(a))||new Date}});ve(n)}catch(t){console.error("조정 로그 로드 오류:",t)}},re=({topic:t,setTopic:s,onSave:l,onCancel:n,isNew:r=!1})=>e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 space-y-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:r?"새 의제 추가":`의제 수정: ${t.title}`}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[r&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"의제 ID (영문)"}),e.jsx("input",{type:"text",value:t.id,onChange:a=>s({...t,id:a.target.value.replace(/[^a-zA-Z0-9]/g,"")}),placeholder:"예: newTopic123",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:r?"":"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"제목"}),e.jsx("input",{type:"text",value:t.title,onChange:a=>s({...t,title:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"부제목"}),e.jsx("input",{type:"text",value:t.subtitle,onChange:a=>s({...t,subtitle:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"설명"}),e.jsx("textarea",{value:t.description,onChange:a=>s({...t,description:a.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"상세 제목"}),e.jsx("input",{type:"text",value:t.detail,onChange:a=>s({...t,detail:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"마감일"}),e.jsx("input",{type:"date",value:t.deadline,onChange:a=>s({...t,deadline:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"상세 내용"}),e.jsx("textarea",{value:t.detailContent,onChange:a=>s({...t,detailContent:a.target.value}),rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"찬성 버튼 텍스트"}),e.jsx("input",{type:"text",value:t.agreeText,onChange:a=>s({...t,agreeText:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"반대 버튼 텍스트"}),e.jsx("input",{type:"text",value:t.disagreeText,onChange:a=>s({...t,disagreeText:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"테마 색상"}),e.jsx("div",{className:"flex gap-2",children:ue.map(a=>e.jsx("button",{type:"button",onClick:()=>s({...t,color:a.value}),style:{backgroundColor:a.bg},className:`w-8 h-8 rounded-full ${t.color===a.value?"ring-2 ring-offset-2 ring-gray-400":""}`,title:a.label},a.value))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"상태"}),e.jsxs("select",{value:t.status,onChange:a=>s({...t,status:a.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"active",children:"활성 (투표 가능)"}),e.jsx("option",{value:"closed",children:"종료 (투표 불가)"}),e.jsx("option",{value:"draft",children:"초안 (비공개)"})]})]})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:l,disabled:S,className:"flex-1 py-2 bg-blue-600 text-white rounded-lg font-medium hover:bg-blue-700 transition disabled:opacity-50",children:S?"저장 중...":"저장"}),e.jsx("button",{onClick:n,className:"flex-1 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition",children:"취소"})]})]});return me?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-4",children:"접근 권한이 없습니다"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"올바른 관리자 링크로 접속해주세요."}),e.jsx(ce,{to:"/",className:"px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"홈으로 돌아가기"})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-100",children:[e.jsx("header",{className:"fixed top-0 left-0 right-0 z-50 bg-white/80 backdrop-blur-md border-b border-gray-200",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between items-center h-16",children:[e.jsx(ce,{to:"/",className:"text-xl font-bold text-blue-600",children:"시민법정"}),e.jsxs("div",{className:"flex items-center gap-4",children:[K&&e.jsx("span",{className:"text-sm text-green-600 font-medium bg-green-50 px-3 py-1 rounded-full",children:"관리자 모드"}),e.jsx("a",{href:"/governance",target:"_blank",rel:"noopener noreferrer",className:"text-gray-600 hover:text-blue-600 transition text-sm",children:"거버넌스 페이지 보기 ↗"})]})]})})}),e.jsx("main",{className:"pt-24 pb-16 px-4",children:e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 text-center mb-8",children:"거버넌스 관리자 설정"}),K?e.jsxs("div",{className:"space-y-6",children:[I&&e.jsx("p",{className:"text-red-600 bg-red-50 p-4 rounded-xl",children:I}),H&&e.jsx("p",{className:"text-green-600 bg-green-50 p-4 rounded-xl",children:H}),e.jsx("div",{className:"flex gap-2 bg-white p-2 rounded-xl shadow flex-wrap",children:[{id:"topics",label:"의제 관리",count:b.length},{id:"proposals",label:"시민 제안",count:N.length},{id:"votes",label:"투표 관리",count:null}].map(t=>e.jsxs("button",{onClick:()=>he(t.id),className:`flex-1 py-3 px-4 rounded-lg font-medium transition ${P===t.id?"bg-blue-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[t.label," ",t.count!==null&&`(${t.count})`]},t.id))}),P==="topics"&&e.jsxs("div",{className:"space-y-4",children:[!F&&!v&&e.jsx("button",{onClick:()=>q(!0),className:"w-full py-4 bg-green-600 text-white rounded-xl font-medium hover:bg-green-700 transition",children:"+ 새 의제 추가"}),F&&e.jsx(re,{topic:$,setTopic:Y,onSave:De,onCancel:()=>q(!1),isNew:!0}),v&&e.jsx(re,{topic:v,setTopic:L,onSave:Ce,onCancel:()=>L(null),isNew:!1}),!F&&!v&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"의제 목록"}),S?e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"})}):e.jsxs("div",{className:"space-y-3",children:[b.map(t=>e.jsx("div",{className:"p-4 bg-gray-50 rounded-xl",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 flex-wrap",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:le(t.color)}}),e.jsx("h3",{className:"font-semibold text-gray-800",children:t.title}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t.status==="active"?"bg-green-100 text-green-700":t.status==="closed"?"bg-gray-100 text-gray-700":"bg-yellow-100 text-yellow-700"}`,children:t.status==="active"?"활성":t.status==="closed"?"종료":"초안"})]}),e.jsx("p",{className:"text-sm text-gray-600 truncate",children:t.subtitle}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1 flex flex-wrap gap-2",children:[e.jsxs("span",{children:["ID: ",t.id]}),e.jsxs("span",{children:["마감: ",t.deadline||"미설정"]}),w[t.id]&&e.jsxs("span",{className:"text-blue-600",children:["찬성 ",w[t.id].agree," / 반대 ",w[t.id].disagree]}),Q[t.id]!==void 0&&e.jsxs("span",{className:"text-purple-600",children:["댓글 ",Q[t.id]]})]})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[se(t.id)&&e.jsx("button",{onClick:()=>Ae(t),className:"px-3 py-1.5 bg-yellow-100 text-yellow-700 rounded-lg text-sm hover:bg-yellow-200",title:"한글 ID를 영문 ID로 변경합니다 (투표 오류 해결)",children:"ID수정"}),e.jsx("button",{onClick:()=>L({...t}),className:"px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg text-sm hover:bg-blue-200",children:"수정"}),e.jsx("button",{onClick:()=>Se(t.id),className:"px-3 py-1.5 bg-red-100 text-red-700 rounded-lg text-sm hover:bg-red-200",children:"삭제"})]})]})},t.id)),b.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"등록된 의제가 없습니다."})]})]})]}),P==="proposals"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"시민 제안 목록"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4 border-b pb-4",children:[{id:"all",label:"전체",count:N.length},{id:"proposal",label:"제안중",count:N.filter(t=>t.status==="proposal").length,color:"blue"},{id:"promoted",label:"승격됨",count:N.filter(t=>t.status==="promoted").length,color:"green"},{id:"rejected",label:"반려됨",count:N.filter(t=>t.status==="rejected").length,color:"red"}].map(t=>e.jsxs("button",{onClick:()=>je(t.id),className:`px-4 py-2 rounded-lg text-sm font-medium transition-colors ${f===t.id?t.color==="blue"?"bg-blue-600 text-white":t.color==="green"?"bg-green-600 text-white":t.color==="red"?"bg-red-600 text-white":"bg-gray-800 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:[t.label," (",t.count,")"]},t.id))}),e.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-3 mb-4",children:e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsx("strong",{children:"자동 승격/반려 시스템:"})," 제안일로부터 30일 이내 10명 이상 추천 시 자동 승격, 30일 경과 후 추천 수 미달 시 자동 반려됩니다."]})}),g?e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 rounded-xl",children:[e.jsx("h3",{className:"font-semibold",children:"제안 수정"}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"제목"}),e.jsx("input",{type:"text",value:g.title,onChange:t=>A({...g,title:t.target.value}),className:"w-full px-3 py-2 border rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"설명"}),e.jsx("textarea",{value:g.description,onChange:t=>A({...g,description:t.target.value}),rows:3,className:"w-full px-3 py-2 border rounded-lg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"상태"}),e.jsxs("select",{value:g.status,onChange:t=>A({...g,status:t.target.value}),className:"w-full px-3 py-2 border rounded-lg",children:[e.jsx("option",{value:"proposal",children:"제안 중"}),e.jsx("option",{value:"promoted",children:"승격됨"}),e.jsx("option",{value:"rejected",children:"반려됨"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:$e,className:"flex-1 py-2 bg-blue-600 text-white rounded-lg",children:"저장"}),e.jsx("button",{onClick:()=>A(null),className:"flex-1 py-2 bg-gray-200 rounded-lg",children:"취소"})]})]}):e.jsxs("div",{className:"space-y-3",children:[N.filter(t=>f==="all"||t.status===f).map(t=>{var s,l,n,r,a,d;return e.jsx("div",{className:"p-4 bg-gray-50 rounded-xl",children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 flex-wrap",children:[e.jsx("h3",{className:"font-semibold text-gray-800",children:t.title}),e.jsx("span",{className:`text-xs px-2 py-0.5 rounded-full ${t.status==="proposal"?"bg-blue-100 text-blue-700":t.status==="promoted"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"}`,children:t.status==="proposal"?"제안 중":t.status==="promoted"?"승격됨":"반려됨"})]}),e.jsx("p",{className:"text-sm text-gray-600 line-clamp-2",children:t.description}),e.jsxs("div",{className:"text-xs text-gray-500 mt-1 flex flex-wrap gap-2",children:[e.jsxs("span",{children:["제안자: ",t.proposerName]}),e.jsxs("span",{className:"text-orange-600",children:["추천 ",be[t.id]||0,"명"]}),e.jsxs("span",{children:["제안일: ",((l=(s=t.createdAt)==null?void 0:s.toLocaleDateString)==null?void 0:l.call(s))||""]})]}),t.status==="rejected"&&t.rejectedReason&&e.jsxs("div",{className:"mt-2 text-xs bg-red-50 text-red-600 p-2 rounded",children:[e.jsx("strong",{children:"반려 사유:"})," ",t.rejectedReason,t.rejectedAt&&e.jsxs("span",{className:"ml-2 text-red-400",children:["(반려일: ",((r=(n=t.rejectedAt)==null?void 0:n.toLocaleDateString)==null?void 0:r.call(n))||new Date(t.rejectedAt).toLocaleDateString(),")"]})]}),t.status==="promoted"&&t.promotedAt&&e.jsxs("div",{className:"mt-2 text-xs bg-green-50 text-green-600 p-2 rounded",children:[e.jsx("strong",{children:"승격일:"})," ",((d=(a=t.promotedAt)==null?void 0:a.toLocaleDateString)==null?void 0:d.call(a))||new Date(t.promotedAt).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex flex-col gap-2 shrink-0",children:[t.status==="proposal"&&e.jsx("button",{onClick:()=>Te(t),className:"px-3 py-1.5 bg-green-100 text-green-700 rounded-lg text-sm hover:bg-green-200",children:"의제로 승격"}),e.jsx("button",{onClick:()=>A({...t}),className:"px-3 py-1.5 bg-blue-100 text-blue-700 rounded-lg text-sm hover:bg-blue-200",children:"수정"}),e.jsx("button",{onClick:()=>ke(t.id),className:"px-3 py-1.5 bg-red-100 text-red-700 rounded-lg text-sm hover:bg-red-200",children:"삭제"})]})]})},t.id)}),N.filter(t=>f==="all"||t.status===f).length===0&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:f==="all"?"등록된 제안이 없습니다.":f==="proposal"?"진행 중인 제안이 없습니다.":f==="promoted"?"승격된 제안이 없습니다.":"반려된 제안이 없습니다."})]})]}),P==="votes"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-4",children:"의제별 투표 현황"}),e.jsxs("div",{className:"space-y-4",children:[b.map(t=>{var s,l,n;return e.jsxs("div",{className:"p-4 bg-gray-50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4 flex-wrap",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:le(t.color)}}),e.jsx("h3",{className:"font-semibold text-gray-800",children:t.title})]}),e.jsxs("div",{className:"flex gap-4 text-sm",children:[e.jsxs("span",{className:"text-green-600 font-medium",children:["찬성: ",((s=w[t.id])==null?void 0:s.agree)||0,"표"]}),e.jsxs("span",{className:"text-red-600 font-medium",children:["반대: ",((l=w[t.id])==null?void 0:l.disagree)||0,"표"]}),e.jsxs("span",{className:"text-gray-500",children:["총 ",((n=w[t.id])==null?void 0:n.total)||0,"표"]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>Re(t.id),disabled:S,className:"px-3 py-2 bg-orange-100 text-orange-700 rounded-lg text-sm hover:bg-orange-200 disabled:opacity-50",children:"테스트 투표 삭제"}),e.jsx("button",{onClick:()=>{M(t.id),k({agree:0,disagree:0,reason:""}),O()},className:"px-3 py-2 bg-purple-100 text-purple-700 rounded-lg text-sm hover:bg-purple-200",children:"투표 수 조정"})]})]}),ye===t.id&&e.jsxs("div",{className:"mt-4 p-4 bg-purple-50 rounded-lg border border-purple-200",children:[e.jsx("h4",{className:"font-medium text-purple-800 mb-3",children:"투표 수 조정"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3 mb-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"찬성 조정 (+ 또는 -)"}),e.jsx("input",{type:"number",value:m.agree,onChange:r=>k({...m,agree:parseInt(r.target.value)||0}),className:"w-full px-3 py-2 border rounded-lg",placeholder:"예: 5 또는 -3"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"반대 조정 (+ 또는 -)"}),e.jsx("input",{type:"number",value:m.disagree,onChange:r=>k({...m,disagree:parseInt(r.target.value)||0}),className:"w-full px-3 py-2 border rounded-lg",placeholder:"예: 5 또는 -3"})]})]}),e.jsxs("div",{className:"mb-3",children:[e.jsx("label",{className:"block text-sm text-gray-600 mb-1",children:"조정 사유 (필수)"}),e.jsx("textarea",{value:m.reason,onChange:r=>k({...m,reason:r.target.value}),rows:2,className:"w-full px-3 py-2 border rounded-lg",placeholder:"조정 사유를 입력하세요 (예: 중복 투표 제거, 테스트 데이터 보정 등)"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>_e(t.id),disabled:S||!m.reason.trim(),className:"flex-1 py-2 bg-purple-600 text-white rounded-lg font-medium hover:bg-purple-700 disabled:opacity-50",children:S?"처리 중...":"조정 적용"}),e.jsx("button",{onClick:()=>M(null),className:"px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300",children:"취소"})]}),e.jsx("p",{className:"text-xs text-purple-600 mt-2",children:"* 조정 내역은 모두 기록되며, 아래 이력에서 확인할 수 있습니다."})]})]},t.id)}),b.length===0&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"등록된 의제가 없습니다."})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800",children:"투표 조정 이력"}),e.jsx("button",{onClick:O,className:"px-3 py-1.5 bg-gray-100 text-gray-700 rounded-lg text-sm hover:bg-gray-200",children:"새로고침"})]}),X.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-3 py-2 text-left",children:"일시"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"의제"}),e.jsx("th",{className:"px-3 py-2 text-center",children:"이전"}),e.jsx("th",{className:"px-3 py-2 text-center",children:"조정"}),e.jsx("th",{className:"px-3 py-2 text-center",children:"이후"}),e.jsx("th",{className:"px-3 py-2 text-left",children:"사유"})]})}),e.jsx("tbody",{children:X.map(t=>{var s,l;return e.jsxs("tr",{className:"border-b hover:bg-gray-50",children:[e.jsx("td",{className:"px-3 py-2 whitespace-nowrap",children:((l=(s=t.adjustedAt)==null?void 0:s.toLocaleString)==null?void 0:l.call(s))||"-"}),e.jsx("td",{className:"px-3 py-2",children:t.topicTitle}),e.jsxs("td",{className:"px-3 py-2 text-center",children:[e.jsxs("span",{className:"text-green-600",children:["찬",t.beforeAgree]})," / ",e.jsxs("span",{className:"text-red-600",children:["반",t.beforeDisagree]})]}),e.jsxs("td",{className:"px-3 py-2 text-center font-medium",children:[e.jsxs("span",{className:t.adjustAgree>=0?"text-green-600":"text-red-600",children:[t.adjustAgree>=0?"+":"",t.adjustAgree]})," / ",e.jsxs("span",{className:t.adjustDisagree>=0?"text-green-600":"text-red-600",children:[t.adjustDisagree>=0?"+":"",t.adjustDisagree]})]}),e.jsxs("td",{className:"px-3 py-2 text-center",children:[e.jsxs("span",{className:"text-green-600",children:["찬",t.afterAgree]})," / ",e.jsxs("span",{className:"text-red-600",children:["반",t.afterDisagree]})]}),e.jsx("td",{className:"px-3 py-2 max-w-xs truncate",title:t.reason,children:t.reason})]},t.id)})})]})}):e.jsx("p",{className:"text-center text-gray-500 py-8",children:"조정 이력이 없습니다."})]}),e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-xl p-4",children:[e.jsx("h3",{className:"font-medium text-red-800 mb-2",children:"주의사항"}),e.jsxs("ul",{className:"text-sm text-red-700 space-y-1",children:[e.jsx("li",{children:"- 테스트 투표 삭제: admin_test_로 시작하는 ID의 투표만 삭제됩니다."}),e.jsx("li",{children:"- 투표 수 조정: 모든 조정 내역은 기록되며 삭제할 수 없습니다."}),e.jsx("li",{children:"- 조정된 투표 수는 실제 투표 데이터에는 영향을 주지 않고, 화면 표시에만 반영됩니다."})]})]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 rounded-xl p-4",children:[e.jsx("h3",{className:"font-medium text-yellow-800 mb-2",children:"안내"}),e.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1",children:[e.jsx("li",{children:"- 의제를 수정하면 즉시 거버넌스 페이지에 반영됩니다."}),e.jsx("li",{children:"- 시민 제안을 의제로 승격하면 30일간 투표가 진행됩니다."}),e.jsx("li",{children:"- 상태를 '초안'으로 설정하면 페이지에 표시되지 않습니다."})]})]})]}):e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-8 max-w-md mx-auto",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-800 mb-6 text-center",children:"관리자 인증"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("input",{type:"password",value:Z,onChange:t=>ge(t.target.value),onKeyPress:t=>t.key==="Enter"&&ee(),placeholder:"관리자 코드를 입력하세요",className:"w-full px-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-blue-500"}),I&&e.jsx("p",{className:"text-sm text-red-600 bg-red-50 p-3 rounded-lg",children:I}),e.jsx("button",{onClick:ee,className:"w-full py-3 bg-blue-600 text-white rounded-xl font-medium hover:bg-blue-700 transition",children:"확인"})]})]})]})})]})}export{Ve as default};
