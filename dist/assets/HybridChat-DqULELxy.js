import{r as n,j as e}from"./index-BRv2x-XL.js";import{F as q,f as E}from"./faq-BjGMJbu-.js";import{g as F}from"./vectorSearch-CEQWKMuY.js";function L(){const[d,l]=n.useState([]),[o,g]=n.useState(""),[x,i]=n.useState(!1),[h,w]=n.useState(null),[m,N]=n.useState(null),y=n.useRef(null);n.useEffect(()=>{const t=new q(E);w(t),F().then(s=>{N(s),console.log("ë²¡í„° ê²€ìƒ‰ ì´ˆê¸°í™” ì™„ë£Œ:",s.getStats())}).catch(s=>{console.error("ë²¡í„° ê²€ìƒ‰ ì´ˆê¸°í™” ì‹¤íŒ¨:",s)}),l([{role:"assistant",content:"ì•ˆë…•í•˜ì„¸ìš”! ì‹œë¯¼ë²•ì • ì±—ë´‡ì…ë‹ˆë‹¤. í˜¼í•©í˜• ì°¸ì‹¬ì œì— ëŒ€í•´ ê¶ê¸ˆí•˜ì‹  ì ì„ ë¬¼ì–´ë³´ì„¸ìš”.",source:"system",timestamp:new Date}])},[]),n.useEffect(()=>{v()},[d]);const v=()=>{var t;(t=y.current)==null||t.scrollIntoView({behavior:"smooth"})},S=async t=>{if(t.preventDefault(),!o.trim()||x)return;const s={role:"user",content:o.trim(),timestamp:new Date};l(a=>[...a,s]),g(""),i(!0);try{const a=h==null?void 0:h.findMatch(o.trim());if(a){const r={role:"assistant",content:`**${a.question}**

${a.answer}`,source:"faq",faqId:a.id,category:a.category,timestamp:new Date};l(c=>[...c,r]),i(!1);return}if(m){const r=m.search(o.trim(),3,.01);if(console.log("ë²¡í„° ê²€ìƒ‰ ê²°ê³¼:",r.length>0?r[0]:"ì—†ìŒ"),r.length>0&&r[0].score>=.2){const c=r[0],j={role:"assistant",content:`[${m.getSourceLabel(c.source)}ì—ì„œ ì°¾ì€ ì •ë³´]

${c.text}`,source:"pdf",timestamp:new Date};l(f=>[...f,j]),i(!1);return}if(r.length>0&&r[0].score>=.05){const c=m.getContextString(o.trim(),3),b=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:o.trim(),context:c})});if(b.ok){const f={role:"assistant",content:(await b.json()).answer,source:"ai+pdf",timestamp:new Date};l(I=>[...I,f]),i(!1);return}}}const u=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:o.trim(),conversationHistory:d.slice(-6)})});if(!u.ok)throw new Error("API ìš”ì²­ ì‹¤íŒ¨");const p=await u.json(),A={role:"assistant",content:p.answer,source:p.cached?"cache":"ai",timestamp:new Date};l(r=>[...r,A])}catch(a){console.error("Error:",a);const u={role:"assistant",content:"ì£„ì†¡í•©ë‹ˆë‹¤. ì¼ì‹œì ì¸ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",source:"error",timestamp:new Date};l(p=>[...p,u])}finally{i(!1)}},D=t=>{g(t)},R=t=>{const s={faq:{text:"FAQ",color:"bg-green-100 text-green-800"},pdf:{text:"PDF",color:"bg-yellow-100 text-yellow-800"},"ai+pdf":{text:"AI+PDF",color:"bg-orange-100 text-orange-800"},cache:{text:"ìºì‹œ",color:"bg-blue-100 text-blue-800"},ai:{text:"AI",color:"bg-purple-100 text-purple-800"},system:{text:"ì‹œìŠ¤í…œ",color:"bg-gray-100 text-gray-800"},error:{text:"ì˜¤ë¥˜",color:"bg-red-100 text-red-800"}},a=s[t]||s.system;return e.jsx("span",{className:`text-xs px-2 py-1 rounded-full ${a.color}`,children:a.text})};return e.jsxs("div",{className:"flex flex-col h-screen bg-gradient-to-br from-blue-50 via-white to-purple-50",children:[e.jsx("div",{className:"bg-white shadow-sm border-b border-gray-200 px-6 py-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"ì‹œë¯¼ë²•ì • AI ì±—ë´‡"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"FAQ ìš°ì„  ê²€ìƒ‰ â†’ ìºì‹œ í™•ì¸ â†’ AI ì‘ë‹µ (í•˜ì´ë¸Œë¦¬ë“œ ì‹œìŠ¤í…œ)"})]})}),d.length<=3&&e.jsxs("div",{className:"max-w-4xl mx-auto w-full px-6 py-4",children:[e.jsx("p",{className:"text-sm font-semibold text-gray-700 mb-3",children:"ìì£¼ ë¬»ëŠ” ì§ˆë¬¸:"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:["í˜¼í•©í˜• ì°¸ì‹¬ì œê°€ ë¬´ì—‡ì¸ê°€ìš”?","ì‹œë¯¼ë²•ê´€ì€ ì–´ë–»ê²Œ ì„ ë°œë˜ë‚˜ìš”?","í—Œë²• ê°œì •ì´ í•„ìš”í•œê°€ìš”?"].map((t,s)=>e.jsx("button",{onClick:()=>D(t),className:"text-left text-sm px-4 py-2 bg-white hover:bg-gray-50 border border-gray-200 rounded-lg transition-colors",children:t},s))})]}),e.jsx("div",{className:"flex-1 overflow-y-auto px-6 py-4",children:e.jsxs("div",{className:"max-w-4xl mx-auto space-y-4",children:[d.map((t,s)=>e.jsx("div",{className:`flex ${t.role==="user"?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[80%] rounded-lg px-4 py-3 ${t.role==="user"?"bg-blue-600 text-white":"bg-white border border-gray-200 text-gray-900"}`,children:[t.role==="assistant"&&e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[R(t.source),t.category&&e.jsx("span",{className:"text-xs text-gray-500",children:t.category})]}),e.jsx("div",{className:"whitespace-pre-line text-sm leading-relaxed",children:t.content}),e.jsx("div",{className:"text-xs opacity-60 mt-2",children:t.timestamp.toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"})})]})},s)),x&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-white border border-gray-200 rounded-lg px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"0.2s"}}),e.jsx("span",{className:"text-sm text-gray-600 ml-2",children:"ë‹µë³€ ìƒì„± ì¤‘..."})]})})}),e.jsx("div",{ref:y})]})}),e.jsx("div",{className:"bg-white border-t border-gray-200 px-6 py-4",children:e.jsxs("form",{onSubmit:S,className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:o,onChange:t=>g(t.target.value),placeholder:"ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”...",className:"flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",disabled:x}),e.jsx("button",{type:"submit",disabled:x||!o.trim(),className:"px-6 py-3 bg-blue-600 text-white rounded-lg font-semibold hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:"ì „ì†¡"})]}),e.jsxs("div",{className:"flex items-center gap-4 mt-2 text-xs text-gray-500",children:[e.jsx("span",{children:"ğŸ’¡ FAQ 50ê°œ (ë¬´ë£Œ)"}),e.jsx("span",{children:"ğŸ“„ PDF ê²€ìƒ‰ (ë¬´ë£Œ)"}),e.jsx("span",{children:"ğŸ¤– AI ìš”ì•½ (í•„ìš”ì‹œë§Œ)"})]})]})})]})}export{L as default};
