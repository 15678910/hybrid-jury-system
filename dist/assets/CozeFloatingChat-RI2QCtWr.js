import{r as l,j as e}from"./index-BRv2x-XL.js";import{F as _,f as K}from"./faq-BjGMJbu-.js";import{g as z}from"./vectorSearch-CEQWKMuY.js";function H(){const[x,q]=l.useState(!1),[I,d]=l.useState([]),[m,N]=l.useState(""),[y,f]=l.useState(!1),[v,C]=l.useState(null),[j,E]=l.useState(null),A=l.useRef(null),w=l.useRef(null);l.useEffect(()=>{const t=new _(K);C(t),(async()=>{try{const s=await z();E(s),console.log("ë²¡í„° ê²€ìƒ‰ ì´ˆê¸°í™” ì™„ë£Œ:",s.getStats())}catch(s){console.log("ë²¡í„° ê²€ìƒ‰ ì´ˆê¸°í™” ì‹¤íŒ¨:",s)}})(),d([{role:"assistant",content:`ì•ˆë…•í•˜ì„¸ìš”! ì‹œë¯¼ë²•ì • AI ìƒë‹´ì‚¬ì…ë‹ˆë‹¤.
ì°¸ì‹¬ì œì— ëŒ€í•´ ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”.`,source:"system",timestamp:new Date}])},[]);const S=l.useRef(null);l.useEffect(()=>{F()},[I]),l.useEffect(()=>{x&&w.current&&w.current.focus()},[x]);const F=()=>{if(S.current){const n=S.current.querySelectorAll('[data-type="question"]');n.length>0&&n[n.length-1].scrollIntoView({behavior:"smooth",block:"start"})}},M=async t=>{var p;if(t.preventDefault(),!m.trim()||y)return;const n={role:"user",content:m.trim(),timestamp:new Date};d(o=>[...o,n]);const s=m.trim();N(""),f(!0);try{const o=v==null?void 0:v.findMatch(s);if(o){const c={role:"assistant",content:o.answer,source:"faq",faqId:o.id,category:o.category,timestamp:new Date};d(g=>[...g,c]),f(!1);return}let r=[];if(j)try{r=j.search(s,10,.01),console.log("PDF ê²€ìƒ‰ ê²°ê³¼:",r.length,"ê°œ"),r.length>0&&(console.log("ìµœê³  ì ìˆ˜:",r[0].score,"ì†ŒìŠ¤:",r[0].source),console.log("í…ìŠ¤íŠ¸ ë¯¸ë¦¬ë³´ê¸°:",(p=r[0].text)==null?void 0:p.substring(0,100)))}catch(c){console.log("PDF ê²€ìƒ‰ ì˜¤ë¥˜:",c)}else console.log("vectorSearchê°€ nullì…ë‹ˆë‹¤!");if(r.length>0){const c=r.map(a=>`[ì¶œì²˜: ${j.getSourceLabel(a.source)}]
${a.text}`).join(`

---

`);try{const a=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({question:s,context:c})});if(a.ok){const b=await a.json();if(b.error)throw new Error(b.error);const R={role:"assistant",content:b.answer,source:"ai",timestamp:new Date};d(D=>[...D,R]),f(!1);return}}catch(a){console.log("AI API í˜¸ì¶œ ì‹¤íŒ¨, PDF ì§ì ‘ í‘œì‹œ:",a)}const g=s.match(/[ê°€-í£]{2,}/g)||[],T={ë¶í•œ:["ë¶í•œì˜ 1976ë…„ ì¬íŒì†Œêµ¬ì„±ë²•","ì¸ë¯¼ì°¸ì‹¬ì›ì€ 1ë…„ì—","ë¶í•œë„ 1945ë…„ ì´í›„"],ë…ì¼:["ë…ì¼ì˜ ì¬íŒì œë„ì™€ í˜„ì‹¤","ë…ì¼ ì°¸ì‹¬ì œì˜ ì—­ì‚¬"],í•€ë€ë“œ:["í•€ë€ë“œì—ì„œëŠ”","í•€ë€ë“œì˜ ì°¸ì‹¬ì›"],ìŠ¤ì›¨ë´:["ìŠ¤ì›¨ë´ì—ì„œëŠ” ì¶œíŒì†Œì†¡"],ì¤‘êµ­:["1951ë…„ì˜ ë²•ì›ì¡°ì§ë²•","ì¸ë¯¼ë²•ì›ì˜ ì²´ê³„"]};let u=null;for(const[a,b]of Object.entries(T))if(s.includes(a)&&(u=r.find(R=>b.some(D=>R.text.includes(D))),u))break;u||(u=r[0]);const V=j.getSourceLabel(u.source);let i=u.text;const k=g[0];if(k&&i.length>500){const a=i.indexOf(k);a>30?i="..."+i.substring(a-20,a+480):i=i.substring(0,500),i.length>=500&&(i+="...")}const $={role:"assistant",content:`[${V}ì—ì„œ ì°¾ì€ ì •ë³´]

${i}`,source:"pdf",timestamp:new Date};d(a=>[...a,$]),f(!1);return}const h={role:"assistant",content:`í•´ë‹¹ ì§ˆë¬¸ì— ëŒ€í•œ ë‹µë³€ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.

ì•„ë˜ ì£¼ì œì— ëŒ€í•´ ì§ˆë¬¸í•´ ë³´ì„¸ìš”:
â€¢ ì°¸ì‹¬ì œê°€ ë¬´ì—‡ì¸ê°€ìš”?
â€¢ ì°¸ì‹¬ì œì™€ ë°°ì‹¬ì œì˜ ì°¨ì´ì 
â€¢ í—Œë²• ê°œì •ì´ í•„ìš”í•œê°€ìš”?
â€¢ ì‹œë¯¼ë²•ê´€ ì„ ë°œ ë°©ë²•
â€¢ ì‹œë¯¼ë²•ê´€ì˜ ê¶Œí•œê³¼ ë³´ìˆ˜`,source:"system",timestamp:new Date};d(c=>[...c,h])}catch(o){console.error("Error:",o);const r={role:"assistant",content:"ì£„ì†¡í•©ë‹ˆë‹¤. ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.",source:"error",timestamp:new Date};d(h=>[...h,r])}finally{f(!1)}},Q=t=>{var n;N(t),(n=w.current)==null||n.focus()},L=t=>{const n={faq:{text:"FAQ",color:"bg-emerald-500",icon:"ğŸ“‹"},pdf:{text:"ë¬¸ì„œ",color:"bg-blue-500",icon:"ğŸ“„"},ai:{text:"AI",color:"bg-purple-500",icon:"âœ¨"},system:{text:"ì•ˆë‚´",color:"bg-gray-500",icon:"ğŸ’¬"},error:{text:"ì˜¤ë¥˜",color:"bg-red-500",icon:"âš ï¸"}},s=n[t]||n.system;return e.jsxs("span",{className:`inline-flex items-center gap-1 text-[10px] px-2 py-0.5 rounded-full text-white ${s.color}`,children:[e.jsx("span",{children:s.icon}),s.text]})},O=(t,n)=>t?t.replace(/^\[.*?\]\n\n/,"").split(`

`).filter(o=>o.trim()).map((o,r)=>{if(o.includes("â€¢")||o.includes("-")){const h=o.split(/[â€¢\-]/).filter(c=>c.trim());return e.jsx("ul",{className:"list-none space-y-1 my-2",children:h.map((c,g)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-blue-500 mt-0.5",children:"â€¢"}),e.jsx("span",{children:c.trim()})]},g))},r)}return e.jsx("p",{className:r>0?"mt-2":"",children:o},r)}):null,P=["ì°¸ì‹¬ì œê°€ ë¬´ì—‡ì¸ê°€ìš”?","í—Œë²• ê°œì •ì´ í•„ìš”í•œê°€ìš”?","ì‹œë¯¼ë²•ê´€ì€ ì–´ë–»ê²Œ ì„ ë°œë˜ë‚˜ìš”?","ì°¸ì‹¬ì œì™€ ë°°ì‹¬ì œì˜ ì°¨ì´ëŠ”?","ì‹œë¯¼ë²•ê´€ì˜ ê¶Œí•œì€ ë¬´ì—‡ì¸ê°€ìš”?"];return e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>q(!x),className:"fixed bottom-6 right-6 w-16 h-16 transition-all duration-300 hover:scale-110 z-50 bg-transparent","aria-label":x?"ì±—ë´‡ ë‹«ê¸°":"ì±—ë´‡ ì—´ê¸°",children:e.jsx("img",{src:"/Chatbot_Message_Bubble__1.png",alt:"ì±—ë´‡",className:"w-full h-full object-contain"})}),x&&e.jsxs("div",{className:"fixed bottom-24 right-6 w-[360px] h-[520px] bg-white rounded-2xl shadow-2xl z-50 flex flex-col overflow-hidden border border-gray-200 animate-in slide-in-from-bottom-4 duration-300",children:[e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 to-purple-600 text-white px-4 py-3 flex items-center justify-between",children:[e.jsx("div",{children:e.jsx("h3",{className:"font-bold text-base",children:"ì‹œë¯¼ë²•ê´€ ì°¸ì‹¬ì œ AI ìƒë‹´"})}),e.jsx("button",{onClick:()=>q(!1),className:"text-white/80 hover:text-white text-xl",children:"âœ•"})]}),e.jsxs("div",{ref:S,className:"flex-1 overflow-y-auto px-3 pt-0 pb-3 space-y-2",children:[I.map((t,n)=>e.jsxs("div",{children:[t.role==="user"&&e.jsxs("div",{"data-type":"question",className:"bg-gradient-to-r from-blue-600 to-indigo-600 rounded-xl px-4 py-2 mb-2 shadow-md scroll-mt-1",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:"text-white text-xs",children:"ğŸ”"}),e.jsx("span",{className:"text-[10px] text-blue-100 font-medium",children:"ì§ˆë¬¸"})]}),e.jsx("p",{className:"text-[14px] font-semibold text-white leading-relaxed",children:t.content})]}),t.role==="assistant"&&e.jsxs("div",{className:"bg-white border border-gray-200 rounded-xl shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-gray-50 border-b border-gray-100",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[L(t.source),t.category&&e.jsx("span",{className:"text-[10px] text-gray-500",children:t.category})]}),e.jsx("span",{className:"text-[10px] text-gray-400",children:t.timestamp.toLocaleTimeString("ko-KR",{hour:"2-digit",minute:"2-digit"})})]}),e.jsxs("div",{className:"px-3 py-3",children:[e.jsx("div",{className:"text-[13px] leading-[1.7] text-gray-700",children:O(t.content,t.source)}),t.source==="system"&&n===0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100",children:[e.jsx("p",{className:"text-[11px] text-gray-500 mb-2 font-medium",children:"ìì£¼ ë¬»ëŠ” ì§ˆë¬¸"}),e.jsx("div",{className:"grid grid-cols-1 gap-1.5",children:P.map((s,p)=>e.jsxs("button",{onClick:()=>Q(s),className:"text-[12px] px-3 py-2 bg-gray-50 border border-gray-200 rounded-lg hover:bg-blue-50 hover:border-blue-300 hover:text-blue-700 transition-all text-left flex items-center gap-2",children:[e.jsx("span",{className:"text-gray-400",children:"â†’"}),s]},p))})]})]})]})]},n)),y&&e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"bg-gray-100 rounded-2xl rounded-bl-md px-3 py-2",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-bounce"}),e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),e.jsx("div",{className:"w-2 h-2 bg-blue-600 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]})})}),e.jsx("div",{ref:A})]}),e.jsx("form",{onSubmit:M,className:"p-3 border-t border-gray-200 bg-white",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{ref:w,type:"text",value:m,onChange:t=>N(t.target.value),placeholder:"ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”...",className:"flex-1 px-3 py-2 text-sm border border-gray-300 rounded-full focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none",disabled:y}),e.jsx("button",{type:"submit",disabled:y||!m.trim(),className:"px-4 py-2 bg-blue-600 text-white rounded-full text-sm font-medium hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors",children:"ì „ì†¡"})]})})]})]})}export{H as default};
