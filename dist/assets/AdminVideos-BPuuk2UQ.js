import{r as a,c as k,d as h,q as R,o as K,g as q,j as e,L as G,x as D,e as J,p as A,u as O,b as I,a as P}from"./index-BRv2x-XL.js";import{H as Q}from"./Header-DKW4VDud.js";const g=l=>{const f=[/(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/,/youtube\.com\/shorts\/([^&\n?#]+)/];for(const d of f){const n=l.match(d);if(n)return n[1]}return null};function _(){const[l,f]=a.useState(""),[d,n]=a.useState(!1),[v,p]=a.useState(""),[C,b]=a.useState(!1),[i,c]=a.useState([]),[M,S]=a.useState(!1),[U,N]=a.useState(!1),[x,L]=a.useState(null),[r,o]=a.useState({title:"",url:"",description:"",category:"해외 사례"}),[V,y]=a.useState(!1),W=["해외 사례","사법개혁","인터뷰","뉴스"],E=async()=>{if(!l.trim()){alert("작성자 코드를 입력해주세요.");return}b(!0);const t="SbAdmin2025!",s="SbWriter2025!";if(l===t){n(!0),p("관리자"),b(!1);return}if(l===s){n(!0),p("시민법정"),b(!1);return}try{const j=k(h,"writerCodes"),w=R(j,D("code","==",l),D("active","==",!0)),m=await q(w);if(m.empty)alert("유효하지 않거나 비활성화된 작성자 코드입니다.");else{const z=m.docs[0].data();n(!0),p(z.name)}}catch(j){console.error("Error verifying writer code:",j),alert("인증에 실패했습니다. 다시 시도해주세요.")}finally{b(!1)}};a.useEffect(()=>{d&&F()},[d]);const F=async()=>{S(!0);try{const t=k(h,"videos"),s=R(t,K("createdAt","desc")),w=(await q(s)).docs.map(m=>({id:m.id,...m.data()}));c(w)}catch(t){console.error("Error fetching videos:",t)}finally{S(!1)}},T=async()=>{if(!r.title||!r.url){alert("제목과 URL을 입력해주세요.");return}const t=g(r.url);if(!t){alert("유효한 YouTube URL을 입력해주세요.");return}y(!0);try{const s=await J(k(h,"videos"),{...r,videoId:t,author:v,writerCode:l,createdAt:A()});c([{id:s.id,...r,videoId:t,author:v},...i]),u(),alert("동영상이 추가되었습니다.")}catch(s){console.error("Error adding video:",s),alert("추가에 실패했습니다.")}finally{y(!1)}},B=async()=>{if(!r.title||!r.url){alert("제목과 URL을 입력해주세요.");return}const t=g(r.url);if(!t){alert("유효한 YouTube URL을 입력해주세요.");return}y(!0);try{await O(I(h,"videos",x.id),{...r,videoId:t,updatedAt:A()}),c(i.map(s=>s.id===x.id?{...s,...r,videoId:t}:s)),u(),alert("동영상이 수정되었습니다.")}catch(s){console.error("Error updating video:",s),alert("수정에 실패했습니다.")}finally{y(!1)}},Y=async t=>{if(confirm("정말 이 동영상을 삭제하시겠습니까?"))try{await P(I(h,"videos",t)),c(i.filter(s=>s.id!==t)),alert("동영상이 삭제되었습니다.")}catch(s){console.error("Error deleting video:",s),alert("삭제에 실패했습니다.")}},H=t=>{L(t),o({title:t.title,url:t.url,description:t.description||"",category:t.category||"해외 사례"}),N(!0)},u=()=>{N(!1),L(null),o({title:"",url:"",description:"",category:"해외 사례"})},$=()=>{n(!1),f(""),p(""),c([])};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx(Q,{}),e.jsx("main",{className:"pt-24 pb-16 px-4",children:e.jsxs("div",{className:"container mx-auto max-w-4xl",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-8 text-center",children:"작성자 관리"}),d?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-xl p-4 mb-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-green-600 text-xl",children:"✓"}),e.jsxs("span",{className:"text-green-800",children:[e.jsx("strong",{children:v}),"님으로 인증되었습니다."]})]}),e.jsx("button",{onClick:$,className:"text-sm text-gray-500 hover:text-gray-700",children:"로그아웃"})]}),e.jsx("div",{className:"flex justify-end mb-6",children:e.jsxs("button",{onClick:()=>{u(),N(!0)},className:"px-6 py-3 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition flex items-center gap-2",children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})}),"동영상 추가"]})}),e.jsxs("div",{className:"bg-white rounded-xl shadow-md overflow-hidden",children:[e.jsx("div",{className:"px-6 py-4 bg-gray-50 border-b",children:e.jsxs("h2",{className:"text-lg font-bold text-gray-900",children:["전체 동영상 (",i.length,")"]})}),M?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"inline-block w-8 h-8 border-4 border-red-600 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"mt-4 text-gray-500",children:"동영상을 불러오는 중..."})]}):i.length===0?e.jsx("div",{className:"p-8 text-center text-gray-500",children:"등록된 동영상이 없습니다. 새 동영상을 추가해보세요!"}):e.jsx("div",{className:"divide-y",children:i.map(t=>{const s=t.videoId||g(t.url);return e.jsx("div",{className:"p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"flex-shrink-0 w-24 h-16 bg-gray-100 rounded-lg overflow-hidden",children:e.jsx("img",{src:`https://img.youtube.com/vi/${s}/mqdefault.jpg`,alt:t.title,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex items-center gap-2 mb-1",children:e.jsx("span",{className:"px-2 py-0.5 bg-red-100 text-red-700 text-xs font-medium rounded-full",children:t.category})}),e.jsx("h3",{className:"font-medium text-gray-900 truncate",children:t.title}),t.description&&e.jsx("p",{className:"text-sm text-gray-500 line-clamp-1 mt-1",children:t.description})]}),e.jsxs("div",{className:"flex gap-2 shrink-0",children:[e.jsx("button",{onClick:()=>H(t),className:"px-3 py-1.5 text-sm text-red-600 hover:bg-red-50 rounded-lg transition",children:"수정"}),e.jsx("button",{onClick:()=>Y(t.id),className:"px-3 py-1.5 text-sm text-gray-600 hover:bg-gray-100 rounded-lg transition",children:"삭제"})]})]})},t.id)})})]})]}):e.jsxs("div",{className:"bg-white rounded-xl shadow-md p-8 mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 mb-4",children:"작성자 인증"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"작성자 코드를 입력하여 인증해주세요."}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("input",{type:"text",value:l,onChange:t=>f(t.target.value),onKeyDown:t=>t.key==="Enter"&&E(),placeholder:"작성자 코드 입력",className:"flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent"}),e.jsx("button",{onClick:E,disabled:C,className:"px-6 py-3 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 transition disabled:bg-red-400",children:C?"확인 중...":"인증하기"})]})]}),e.jsx("div",{className:"mt-8 text-center",children:e.jsx(G,{to:"/videos",className:"text-red-600 hover:underline",children:"← 동영상 목록으로 돌아가기"})})]})}),U&&e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsx("div",{className:"bg-white rounded-xl max-w-lg w-full max-h-[90vh] overflow-y-auto",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900",children:x?"동영상 수정":"동영상 추가"}),e.jsx("button",{onClick:u,className:"text-gray-500 hover:text-gray-700",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"YouTube URL *"}),e.jsx("input",{type:"text",value:r.url,onChange:t=>o({...r,url:t.target.value}),placeholder:"https://www.youtube.com/watch?v=...",className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-red-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"제목 *"}),e.jsx("input",{type:"text",value:r.title,onChange:t=>o({...r,title:t.target.value}),placeholder:"동영상 제목",className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-red-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"카테고리"}),e.jsx("select",{value:r.category,onChange:t=>o({...r,category:t.target.value}),className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-red-500",children:W.map(t=>e.jsx("option",{value:t,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"설명 (선택)"}),e.jsx("textarea",{value:r.description,onChange:t=>o({...r,description:t.target.value}),placeholder:"동영상에 대한 간단한 설명",rows:3,className:"w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-red-500"})]}),r.url&&g(r.url)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"미리보기"}),e.jsx("div",{className:"aspect-video rounded-lg overflow-hidden",children:e.jsx("iframe",{src:`https://www.youtube.com/embed/${g(r.url)}`,className:"w-full h-full",frameBorder:"0",allowFullScreen:!0})})]}),e.jsxs("div",{className:"flex gap-3 pt-4",children:[e.jsx("button",{onClick:u,className:"flex-1 py-3 bg-gray-200 text-gray-700 font-medium rounded-lg hover:bg-gray-300",children:"취소"}),e.jsx("button",{onClick:x?B:T,disabled:V,className:"flex-1 py-3 bg-red-600 text-white font-medium rounded-lg hover:bg-red-700 disabled:bg-red-400",children:V?"처리 중...":x?"수정 완료":"동영상 추가"})]})]})]})})}),e.jsx("footer",{className:"bg-gray-900 text-gray-400 py-6 px-4",children:e.jsx("div",{className:"container mx-auto text-center",children:e.jsx("p",{children:"© 주권자사법개혁추진준비위원회"})})})]})}export{_ as default};
